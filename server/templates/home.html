<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Home</title>
</head>

<body>
    {% extends "layout.html" %}
    {% block content %}
    <div class="profile">
        <h2>Welcome to Home Sensor, {{user_info['given_name']}}!</h2>
    </div>
    <div class="weather">
        <h3>Current Weather</h3>
        {% if data.country_code and data.coordinate and data.temp and data.pressure and data.humidity %}
        <div class="col-md-6 col-md-offset-3">
            <p>country code : {{data.country_code}}</p>
            <p>city name : {{data.cityname}}</p>
            <p>coordinate : {{data.coordinate}}</p>
            <p>temp (in celcius) : {{data.temp_cel}}</p>
            <p>pressure : {{data.pressure}} mb</p>
            <p>humidity : {{data.humidity}} %</p>
            </div>
        {% endif %}
    </div>
    <div class="home">
        <h2>Real Time Sensor Monitoring </h2>
        {% for plot in plotInfo %}
        <div class="sensor">
            {% set test = 'bargraph' + loop.index|string %}
            <div class="chart" id={{test}}>
                <script>
                    
                    function deleteSensor() {                        
                        let name = {{plot[1]|tojson}};
                        let user_id = {{user_info['id']|tojson}};
                        fetch(user_id + '/sensors/delete', {
                            method: 'POST',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({name: name})
                        })
                        .then((res) => res.json())
                        .then((res) => {
                            if (res.success) {
                                window.location.reload();
                            } else {
                                alert("Something went wrong. Sorry!")
                            }
                        })
                        
                    }
                    

                    var layout = {
                        title: {
                            text: {{ plot[1] | tojson}}
                        },
                    xaxis: {
                        title: {
                            text: "time"
                        }
                    },
                    yaxis: {
                        title: {
                            text: {{ plot[2] | tojson}}
                        }
                    },
                    }
                    Plotly.plot({{ test }}, {{ plot[0] | safe }}, layout);
                </script>
            </div>
            <button onclick="deleteSensor()">Delete</button>
        </div>
        {% endfor %}
    </div>
    {% endblock %}
</body>

</html>